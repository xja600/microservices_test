server:
  port: 8774

#指定注册中心地址
eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/

#服务的名称
#请求地址： http://localhost:8774/接路由
spring:
  application:
    name: zuul-service


#参考地址：https://blog.csdn.net/qiushisoftware/article/details/106034137
#介绍zuul比较全面的文章：https://www.cnblogs.com/jing99/p/11696192.html
zuul:
#  add-host-header: true #webui重定向  请求头host显示为网关的（eg:localhost:9090）而非webui的
  ignoredServices: '*' #1、禁用服务名路游 此方式相当于给所有新发现的服务默认排除zuul网关访问方式，只有配置了路由网关的服务才可以通过zuul网关访问，即下面再配置服务器或路径的的请求才可以通过
#  sensitive-headers:   #传递头信息
#  retryable: true  #负载均衡时，路游的服务重启时，可通过重试到其他相同服务

#  routes:  #2、URL路径匹配，浏览器请求：http://localhost:8771/api/controller/loan/sendmessage和http://localhost:8774/api/controller/loan/sendmessage  显示的结果一样
#     user-route:   #路由ID，随意写
#       url: http://localhost:8771  #映射的实际路径
#       path: /api/**   #映射路径
#       strip-prefix: false  #默认为true会自动截取请求地址，需要设置为false

  routes:  #3、服务名称匹配，浏览器请求：http://localhost:8771/api/controller/loan/sendmessage和http://localhost:8774/api/controller/loan/sendmessage  显示的结果一样
    user-route:   #路由ID，随意写
      serviceId: eureka-client  #映射的实际服务名称
      path: /api/**   #映射路径
      strip-prefix: false  #默认为true会自动截取请求地址，需要设置为false

#全局限流配置  使用全局限流配置，zuul会对代理的所有服务提供限流保护
  # 开启限流保护  https://www.cnblogs.com/jing99/p/11696192.html
  ratelimit:
    enabled: true
  # 60s内请求超过3次，服务端就抛出异常，60s后可以恢复正常请求
    default-policy:
      limit: 3
      refresh-interval: 60
  # 针对IP进行限流，不影响其他IP  type=URL 对访问的url限流
      type: origin

#局部限流配置  使用局部限流配置，zuul仅针对配置的服务提供限流保护
    # hystrix-application-client服务60s内请求超过3次，服务抛出异常。
    policies:
      hystrix-application-client:
        limit: 3
        refresh-interval: 60
    # 针对IP限流。
        type: origin

# 开启zuul网关重试
  retryable: true
  # hystrix超时时间设置
  # 线程池隔离，默认超时时间1000ms
hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 8000

  # ribbon超时时间设置：建议设置比Hystrix小
  # 请求连接的超时时间: 默认5000ms
ribbon:
    ConnectTimeout: 5000
  # 请求处理的超时时间: 默认5000ms
    ReadTimeout:  5000
  # 重试次数：MaxAutoRetries表示访问服务集群下原节点（同路径访问）；MaxAutoRetriesNextServer表示访问服务集群下其余节点（换台服务器）
    MaxAutoRetries: 1
    MaxAutoRetriesNextServer: 1
  # 开启重试
    OkToRetryOnAllOperations: true


### 针对单个服务的 Ribbon 配置 配置文件的方式只能针对单个服务，全局配置只能代码配置
#这些配置针对 ribbon或者feign,feign其实不是做负载均衡的,负载均衡是ribbon的功能,feign只是集成了ribbon而已,但是负载均衡的功能还是feign内置的ribbon再做,而不是feign。
  #feign的作用的替代RestTemplate,性能比较低，但是可以使代码可读性很强。
    #配置公用
#eureka-client:
message-service:
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule  # 基于配置文件形式的 针对单个服务的 Ribbon 负载均衡策略，配置或者写代码初始化都可以，但是配置优于代码

    #https://www.cnblogs.com/idoljames/p/11698923.html
    ConnectTimeout: 30000
    ReadTimeout: 60000
    MaxAutoRetries: 1 #对第一次请求的服务的重试次数
    MaxAutoRetriesNextServer: 1 #要重试的下一个服务的最大数量（不包括第一个服务）
    OkToRetryOnAllOperations: true
    #说明：这里配置的ConnectTimeout和ReadTimeout是当HTTP客户端使用的是HttpClient才生效，这个时间最终会被设置到HttpClient中。
    #在设置的时候需要结合hystrix的超时时间来综合考虑，针对使用的场景，设置太小会导致很多请求失败，设置太大会导致熔断控制变差。

#参考文章：https://www.cnblogs.com/q149072205/p/14081185.html
# 自定义配置
sysconfig:
  isDebug: true  #是否Debug
  swagger: true  #开启swagger
#@LoadBalanced